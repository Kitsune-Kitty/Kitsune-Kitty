<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>CheerpJ test</title>
    <script src="https://cjrtnc.leaningtech.com/4.1/loader.js"></script>
    <style>
      #display {
        width: 100%;
        height: 100vh;
        border: 1px solid #000;
      }
    </style>
  </head>
  <body>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">Upload File</button>
    <button onclick="downloadFile()">Download File</button>
    <button onclick="listResources()">List Resources</button>
    <div id="display"></div>
    <script>
      let display;

      async function cheerpjInit() {
        await cheerpjInit();
        display = cheerpjCreateDisplay(1080, 1000);
        window.addEventListener('resize', resizeDisplay);
        resizeDisplay();
      }

      function resizeDisplay() {
        const width = window.innerWidth;
        const height = window.innerHeight;
        display.resize(width, height);
      }

      async function uploadFile() {
        const fileInput = document.getElementById('fileInput');
        const file = fileInput.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = async function(event) {
            const arrayBuffer = event.target.result;
            const uint8Array = new Uint8Array(arrayBuffer);
            const fileName = file.name;
            const result = await cheerpjCall('cheerpOSAddStringFile', fileName, uint8Array);
            console.log('File uploaded:', result);
          };
          reader.readAsArrayBuffer(file);
        }
      }

      async function downloadFile() {
        const fileName = prompt('Enter the file name to download:');
        if (fileName) {
          const result = await cheerpjCall('cjFileBlob', fileName);
          if (result) {
            const blob = new Blob([result], { type: 'application/octet-stream' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
          } else {
            console.log('File not found');
          }
        }
      }

      async function listResources() {
        const resources = await cheerpjCall('cjGetRuntimeResources');
        console.log('Loaded resources:', resources);
      }

      (async function () {
        await cheerpjInit();
        await cheerpjRunJar("/app/Kitsune-Kitty/SimpleVideoEditor.jar");
      })();
    </script>
  </body>
</html>
